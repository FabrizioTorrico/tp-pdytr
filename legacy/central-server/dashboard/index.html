<!DOCTYPE html>
<html>

<head>
    <title>Sistema de Vigilancia Distribuido</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background: #222;
            color: white;
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        .cam-container {
            border: 2px solid #444;
            padding: 10px;
            background: #333;
        }

        .alert-box {
            width: 300px;
            height: 400px;
            overflow-y: scroll;
            border: 1px solid red;
            padding: 10px;
            background: #111;
        }

        .log-item {
            border-bottom: 1px solid #444;
            padding: 5px;
            font-size: 0.9em;
        }

        img {
            width: 640px;
            height: 480px;
            background: #000;
        }
    </style>
</head>

<body>

    <div class="cam-container">
        <h2>C치mara 01 (Raspberry Pi)</h2>
        <img src="http://192.168.100.195:5000/video_feed" alt="Esperando video...">
    </div>

    <div class="alert-box" id="alerts">
        <h3>游뚿 Registro de Alertas</h3>
    </div>

    <script>
        // Configuraci칩n MQTT
        client = new Paho.MQTT.Client("localhost", 9001, "web_client_" + parseInt(Math.random() * 100, 10));

        client.onConnectionLost = function (responseObject) {
            console.log("Conexi칩n perdida: " + responseObject.errorMessage);
        };

        client.onMessageArrived = function (message) {
            console.log("Mensaje:", message.payloadString);
            const data = JSON.parse(message.payloadString);

            // Agregar alerta al HTML
            const div = document.createElement("div");
            div.className = "log-item";
            div.innerHTML = `<span style="color:red">MOVIMIENTO</span> <br> Mag: ${parseInt(data.magnitud)} <br> ${new Date(data.ts * 1000).toLocaleTimeString()}`;
            const box = document.getElementById("alerts");
            box.insertBefore(div, box.firstChild);
        };

        client.connect({
            onSuccess: function () {
                console.log("Conectado a MQTT WebSockets");
                client.subscribe("camaras/+/alertas"); // Escuchar todas las c치maras
            },
            useSSL: false
        });
    </script>
</body>

</html>